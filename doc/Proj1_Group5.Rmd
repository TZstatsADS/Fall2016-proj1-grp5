---
title: "Project 1 Group 5"
output:
  html_notebook: default
  html_document: default
---

## What motivates self-employment?

And this is where I will add more descriptive information. 

```{r}
## you will input your code here, so that we can hide it during the presentation
## but it will still generate the necessary output and visualizations
## testing

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).

```{r,echo=FALSE}
setwd("C:/Users/Jackie/Documents/Data Science/Project 1")
data = read.csv("data.ab.csv")
data.non = data[which(data$Class.of.Worker==1),]
data.self = data[which(data$Class.of.Worker==2),]
v = data.non$PWGTP
s = sum(data.non$PWGTP)
p = v/s
v1 = data.self$PWGTP
s1 = sum(data.self$PWGTP)
p1 = v1/s1
cbind(data.non,p)
cbind(data.self,p1)
d.n.n = data.non[sample(nrow(data.non), size = s1, replace = TRUE, prob = data.non$p),]
d.s.n1 = data.self[rep(row.names(data.self),data.self$PWGTP), 1:8]
d.s = d.s.n1[,-1]
d.n = d.n.n[,-9]
d.n = d.n[,-1]
data.f = rbind(d.s,d.n)
data.f$Class.of.Worker[data.f$Class.of.Worker == 2 ] <-  "Self employment"
data.f$Class.of.Worker[data.f$Class.of.Worker == 1 ] <-  "Non Self"
data.f$SEX[data.f$SEX == 1 ] <-  "Male"
data.f$SEX[data.f$SEX == 2 ] <-  "Female"
data.f$NATIVITY[data.f$NATIVITY == 2 ] <-  "Foreign born"
data.f$NATIVITY[data.f$NATIVITY == 1 ] <-  "Native"
data.f$CIT[data.f$CIT==1] <- "Born U.S."
data.f$CIT[data.f$CIT==2] <- "Born U.S."
data.f$CIT[data.f$CIT==3] <- "Born abroad of American parent(s)"
data.f$CIT[data.f$CIT==4] <- "U.S. citizen by naturalization"
data.f$CIT[data.f$CIT==5] <- "Not a citizen of the U.S."
data.f$DIS[data.f$DIS == 1 ] <-  "With a disability"
data.f$DIS[data.f$DIS == 2 ] <-  "Without a disability"

data.f$RAC1P[data.f$RAC1P==1] <- "White alone"
data.f$RAC1P[data.f$RAC1P==2] <- "Black or African American alone"
data.f$RAC1P[data.f$RAC1P==3] <- "American natives"
data.f$RAC1P[data.f$RAC1P==4] <- "American natives"
data.f$RAC1P[data.f$RAC1P==5] <- "American natives"
data.f$RAC1P[data.f$RAC1P==6] <- "Asian alone"
data.f$RAC1P[data.f$RAC1P==7] <- "Native Hawaiian and Other Pacific Islander alone"
data.f$RAC1P[data.f$RAC1P==8] <- "Some Other Race alone"
data.f$RAC1P[data.f$RAC1P==9] <- "Two or More Races"

data.q = data.f
data.q$Class.of.Worker = as.factor(data.q$Class.of.Worker)
data.q$Education.Attainment = as.factor(data.q$Education.Attainment)
data.q$SEX = as.factor(data.q$SEX)
data.q$RAC1P = as.factor(data.q$RAC1P)
data.q$DIS= as.factor(data.q$DIS)
data.q$NATIVITY = as.factor(data.q$NATIVITY)
data.q$CIT = as.factor(data.q$CIT)
```

```{r,echo = FALSE}
head(data.q,5)
```

```{r,echo= FALSE}
library(rpart)
library(RColorBrewer)
library(rattle)
library(rpart.plot)

memory.limit()
memory.limit(size =18000)
```

Third, develped the model and tune the parameters. Picked the best complexity parameter by the minimum cross-validaiton error.
```{r,echo=FALSE}
fit = rpart(Class.of.Worker~Education.Attainment+SEX+NATIVITY+CIT, data = data.q, 
            control=rpart.control(cp=0.00041))

plotcp(fit)
```

Plot the tree.
```{r,echo=FALSE}
library(rattle)
library(rpart.plot)
prp(fit)
```

```{r, echo = FALSE}
fancyRpartPlot(fit, palettes=c("PuBuGn", "Reds"))

```
Here is link for the tree plot:
https://www.dropbox.com/s/gkp9xed6d21ywvt/Rplot04.pdf?dl=0

```{r, echo = FALSE}
library(ggplot2)
library(rgeos)
library(maptools)

library(Cairo)
library(ggmap)
library(scales)
library(RColorBrewer)
require(dplyr)
setwd("C:/Users/Jackie/Documents/Data Science/Project 1/USA_adm/")
states.shp <- readShapeSpatial("USA_adm1.shp")
data.m$ST = replace(data.m$ST, data.m$ST == 1, 3191)
data.m$ST = replace(data.m$ST, data.m$ST == 2, 3192)
data.m$ST = replace(data.m$ST, data.m$ST == 4, 3193)
data.m$ST = replace(data.m$ST, data.m$ST == 5, 3194)
data.m$ST = replace(data.m$ST, data.m$ST == 6, 3195)
data.m$ST = replace(data.m$ST, data.m$ST == 8, 3196)
data.m$ST = replace(data.m$ST, data.m$ST == 9, 3197)
data.m$ST = replace(data.m$ST, data.m$ST == 10, 3198)
data.m$ST = replace(data.m$ST, data.m$ST == 11, 3199)
data.m$ST = replace(data.m$ST, data.m$ST == 12, 3200)
data.m$ST = replace(data.m$ST, data.m$ST == 13, 3201)
data.m$ST = replace(data.m$ST, data.m$ST == 15, 3202)
data.m$ST = replace(data.m$ST, data.m$ST == 16, 3203)
data.m$ST = replace(data.m$ST, data.m$ST == 17, 3204)
data.m$ST = replace(data.m$ST, data.m$ST == 18, 3205)
data.m$ST = replace(data.m$ST, data.m$ST == 19, 3206)
data.m$ST = replace(data.m$ST, data.m$ST == 20, 3207)
data.m$ST = replace(data.m$ST, data.m$ST == 21, 3208)
data.m$ST = replace(data.m$ST, data.m$ST == 22, 3209)
data.m$ST = replace(data.m$ST, data.m$ST == 23, 3210)
data.m$ST = replace(data.m$ST, data.m$ST == 24, 3211)
data.m$ST = replace(data.m$ST, data.m$ST == 25, 3212)
data.m$ST = replace(data.m$ST, data.m$ST == 26, 3213)
data.m$ST = replace(data.m$ST, data.m$ST == 27, 3214)
data.m$ST = replace(data.m$ST, data.m$ST == 28, 3215)
data.m$ST = replace(data.m$ST, data.m$ST == 29, 3216)
data.m$ST = replace(data.m$ST, data.m$ST == 30, 3217)
data.m$ST = replace(data.m$ST, data.m$ST == 31, 3218)
data.m$ST = replace(data.m$ST, data.m$ST == 32, 3219)
data.m$ST = replace(data.m$ST, data.m$ST == 33, 3220)
data.m$ST = replace(data.m$ST, data.m$ST == 34, 3221)
data.m$ST = replace(data.m$ST, data.m$ST == 35, 3222)
data.m$ST = replace(data.m$ST, data.m$ST == 36, 3223)
data.m$ST = replace(data.m$ST, data.m$ST == 37, 3224)
data.m$ST = replace(data.m$ST, data.m$ST == 38, 3225)
data.m$ST = replace(data.m$ST, data.m$ST == 39, 3226)
data.m$ST = replace(data.m$ST, data.m$ST == 40, 3227)
data.m$ST = replace(data.m$ST, data.m$ST == 41, 3228)
data.m$ST = replace(data.m$ST, data.m$ST == 42, 3229)
data.m$ST = replace(data.m$ST, data.m$ST == 44, 3230)
data.m$ST = replace(data.m$ST, data.m$ST == 45, 3231)
data.m$ST = replace(data.m$ST, data.m$ST == 46, 3232)
data.m$ST = replace(data.m$ST, data.m$ST == 47, 3233)
data.m$ST = replace(data.m$ST, data.m$ST == 48, 3234)
data.m$ST = replace(data.m$ST, data.m$ST == 49, 3235)
data.m$ST = replace(data.m$ST, data.m$ST == 50, 3236)
data.m$ST = replace(data.m$ST, data.m$ST == 51, 3237)
data.m$ST = replace(data.m$ST, data.m$ST == 53, 3238)
data.m$ST = replace(data.m$ST, data.m$ST == 54, 3239)
data.m$ST = replace(data.m$ST, data.m$ST == 55, 3240)
data.m$ST = replace(data.m$ST, data.m$ST == 56, 3241)

data.m<-data.m[!(data.m$ST=="72"),]



attach(data.m)
data.m <- group_by(data.m, Class.of.Worker, ST)

data.sum <- summarise(data.m, 
                      weight = sum(PWGTP)
                       )
data.s = data.sum[!(data.sum$Class.of.Worker==1),]
data.n = data.sum[!(data.sum$Class.of.Worker==2),]
colnames(data.s)[2] <- "id"

states.shp.f <- fortify(states.shp, region = "ID_1")
merge.shp.coef<-merge(states.shp.f, data.s, by="id", all.x=TRUE)
attach(merge.shp.coef)
```

```{r, echo =FALSE}
ggplot() +
  geom_polygon(data = final.plot, 
               aes(x = long, y = lat, group = group, fill = weight), 
               color = "Black", size = 0.25) + 
  coord_map()+
  scale_fill_distiller(name="Volume", palette = "Blues", direction = -1, breaks = pretty_breaks(n = 5))+
  theme_nothing(legend = TRUE)
```


