---
title: "Project 1 Group 5"
output: html_notebook
---

## What motivates self-employment?

And this is where I will add more descriptive information. 

```{r}
## you will input your code here, so that we can hide it during the presentation
## but it will still generate the necessary output and visualizations
## testing

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

```{r,include = FALSE ,echo=FALSE}
#here put an r code which loads the requested packages
library("xts") #for time series
library("nloptr") #for optimization
library(zoo)
library("dygraphs") #for plots
library(plotly) # for 3D plots
library("magrittr") # pipes
library("webshot")
library(fBasics)
```
```{r,include = FALSE ,echo=FALSE}
#change the sequence of the variables to make it more convenient for the for loop
data_a2 <-data_a1[,c("PWGTP","SEMP","COW","SCHL","FOD1P","RAC1P","DIS","SEX","CIT","NATIVITY","FSEMP","FCOWP","FSCHLP","FFODP","FRACP","FDISP","FSEXP","FCITP")]

#fill in the missing by using the cold deck method of the data without allocation flag
for(j in 2:9)
{
  if_not_NA<-!is.na(data_a2[,c(j)])
  if_flag_c<-data_a2[,c(j+9)]==0
  sample_c<-which(if_not_NA*if_flag_c==1)
  NA_c<-which(is.na(data_a2[,c(j)]))
  data_a2[,c(j)][NA_c]<-sample(rep(data_a2[,c(j)][sample_c],data_a2$PWGTP[sample_c]),length(data_a2[,c(j)][NA_c]),replace=TRUE)
}

save(data_a2,file="/Users/yifeihu/Documents/Fall2016-proj1-grp5/data/data_a2.Rdata")

#choose the observations that are self-employment
data_a3<-data_a2[which(data_a2$COW==6 | data_a2$COW==7),]

#choose the variables to use
data_a3<-data_a3[,c("PWGTP","SEMP","COW","SCHL","FOD1P","RAC1P","DIS","SEX","CIT","NATIVITY")]
save(data_a3,file="/Users/yifeihu/Documents/Fall2016-proj1-grp5/data/data_a3.Rdata")

#recode the classification of field of degree
#code the field of degree of mathmatics, computer science, and Finace as 1
#code other field of degree as 0
#the reason is that in the ads class, most of as are from one of the kind of degree in 1
for (i in c(2100:2107, 3700:3702,4005))
{
  #cat(i,'\n')
  data_a3$FOD1P[which(data_a3$FOD1P== i)]<-1  
}
data_a3$FOD1P[-which(data_a3$FOD1P == 1)] <- 0
#table(data3$FOD1P)
save(data_a3,file="/Users/yifeihu/Documents/Fall2016-proj1-grp5/data/data_a3.Rdata")

#recode the classification of RACE 
#to code white alone as majority 1 and others as minority 0
data_a3$RAC1P[-which(data_a3$RAC1P==1)]<-0
  
#recode the classification of SCHL 
#to code Bachelor's degree as 31, master's degree as 32,doctorate degree as 33, and others as 30
  data_a3$SCHL[which(data_a3$SCHL==21)]<-31
  data_a3$SCHL[which(data_a3$SCHL==22)]<-32
  data_a3$SCHL[which(data_a3$SCHL==24)]<-33
  data_a3$SCHL[-(which(data_a3$SCHL==31 | data_a3$SCHL==32 | data_a3$SCHL==33))]<-30

#save the data after recode 
data_a4<-data_a3[,c("PWGTP","SEMP","COW","SCHL","FOD1P","RAC1P","DIS","SEX","NATIVITY")]
save(data_a4,file="/Users/yifeihu/Documents/Fall2016-proj1-grp5/data/data_a4.Rdata")

#prepare for linear regression 
data_a5<-data_a4[,c("PWGTP","SEMP","SCHL","FOD1P","RAC1P","DIS","SEX","NATIVITY")]

#to make the category variable as only 1 and 0 category
new <- array()
for ( i in c(30:33))
{
  Y <- array(0, dim = c(length(data_a5$SCHL)))
  Y[which(data_a5$SCHL==i)] <- 1
  new <- cbind(new, Y)
}
new <- as.data.frame(new[,-1])
names <- c(0:3)
for (i in 0:3){
  names[i+1] <- c(paste("SCHL.i",i, sep = ""))
}
colnames(new) <- names
data_r<-cbind(data_a5,new)

data_r$DIS.i<-data_r$DIS-1
data_r$SEX.i<-data_r$SEX-1
data_r$NATIVITY.i<-data_r$NATIVITY-1
data_r$FOD1P.I<-data_r$FOD1P
data_r$RAC1P.I<-data_r$RAC1P
save(data_r,file="/Users/yifeihu/Documents/Fall2016-proj1-grp5/data/data_r.Rdata")

#factor the variables
for(j in 9:17)
{
  data_r[,c(j)]<-factor(data_r[,c(j)])
}
  data_afterf<-data_r
save(data_afterf,file="/Users/yifeihu/Documents/Fall2016-proj1-grp5/data/data_afterf.Rdata")

#do linear regression
m<-lm(SEMP~0+SCHL.i0+SCHL.i1+SCHL.i2+DIS.i+SEX.i+NATIVITY.i+FOD1P.I+RAC1P.I,weight=PWGTP,data=data_afterf)
summary(m)

#use SBC as the criterion to choose model
step(m,k=log(length(data_afterf)))

#to get the correlation matrix
data_forcov<-data_afterf
for(j in 9:17)
{
  data_forcov[,c(j)]<-as.numeric(data_forcov[,c(j)])
}
```
correlation matrix
```{r,include = FALSE , echo = FALSE }
cor(data_forcov[,c("SCHL.i0","SCHL.i1","SCHL.i2","DIS.i","SEX.i","NATIVITY.i","RAC1P.I")])
```

```{r,results='asis'}
knitr::kable(cor(data_forcov[,c("SCHL.i0","SCHL.i1","SCHL.i2","DIS.i","SEX.i","NATIVITY.i","RAC1P.I")]))
```
```{r,include = FALSE , echo = FALSE }
#to get the regression function
m1<-lm(SEMP~0+SCHL.i0 + SCHL.i1 + SCHL.i2 + DIS.i + SEX.i + NATIVITY.i + RAC1P.I,weight=PWGTP,data=data_afterf)
summary(m1)
```

regression results
```{r,results='asis'}
knitr::kable(summary(m1)$coefficients)
```
\[
SEMP=24229.956+3482.857SCHL.i0-10693.914SCHL.i1-10153.449SCHL.i2+7918.872DIS.i1-8628.913SEX.i1+2941.483NATIVITY.i1+5560.645RAC1P.I1
\]
When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).
